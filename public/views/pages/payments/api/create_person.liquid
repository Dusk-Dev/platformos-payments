---
slug: payments/api/persons
method: post
format: json
layout_name: ''
authorization_policies:
---

{%- log params, type: "DEBUG CREATE PERSON API" %}
{%- assign account_id = context.params.account_id %}
{%- assign person_id = context.params.person_id %}
{%- assign person_gateway_id = context.params.person_gateway_id %}
{%- assign token = context.params.person_token %}
{%- assign gateway_api_template = "modules/stripe/create_person" -%}

{%- parse_json 'config' -%}
  {
    "request_type": "create_person",
    "gateway": "stripe"

  }
{%- endparse_json -%}

{%- parse_json 'data' -%}
  {
    "id": "{{ person_id }}",
    "external_id": "{{ account_id }}",
    "gateway_id": "{{ person_gateway_id }}",
    "account_id": "{{ account_id }}",
    "person_token": "{{ token }}"
  }
{%- endparse_json -%}

{% parse_json "account_data" %}
  {
    "properties": [
       { "name": "config", "value": "{{ config | json | escape_javascript }}" },
       { "name": "data", "value":  "{{ data | json | escape_javascript }}" }
     ]
  }
{% endparse_json %}

{% graphql g = "modules/payments/create_customization", form: "modules/payments/gateway_request_mutation_form", data: account_data %}
{% log g, type: "person object response" %}

{% assign error = g.customization_create.properties.request_errors %}
{% if error == blank %}
  { "status": "200" }
{% else %}
  {
    "error": {
      "message": "{{ error }}"
    }
  }
{% endif %}
